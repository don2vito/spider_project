

# 不写一行代码上线一款小工具，快速提取规律文本中的数字

半年前，我写过一篇文章，[正则大法好，快速提取规律文本中的数字](https://mp.weixin.qq.com/s/VFqRVoIQOPekLO1UPs6t6w)，当时遇到的场景需要把钉钉里每天固定格式的文字推送内容进行提取，保存成为 Excel 文件，使用的工具是 Python 的正则表达式。

后来，为了和公司常用的 Excel 公式模板相衔接，我利用 AI 的辅助，通过 VBA 的方式写了一个自定义函数，来抽取当天钉钉推送的文本内容。自定义函数的内容如下，大家有兴趣可以借着之前那篇文章的格式自己操作一下。使用的时候这样写公式，`=Myreg(贴入钉钉文本的单元格,"[\d.-]+",1)`，就能自动返回抽取相应字段的数组。

```basic
Function Myreg(StringValue As String, pattern As String, mode As Long) As Variant
    ' 创建正则表达式对象
    Dim regex As Object
    Set regex = CreateObject("VBScript.RegExp")
    ' 设置正则表达式属性
    regex.Global = True
    regex.IgnoreCase = False
    ' 根据模式执行不同的操作
    Select Case mode
        Case 1 ' 提取
            Dim matches As Object
            regex.pattern = pattern
            Set matches = regex.Execute(StringValue)
            ' 如果没有匹配项，返回空字符串
            If matches.Count = 0 Then
                Myreg = ""
                Exit Function
            End If
           
            ' 将匹配项收集到数组中
            Dim result As Variant
            ReDim result(1 To matches.Count)
            Dim i As Long
            For i = 1 To matches.Count
                result(i) = matches(i - 1).Value
            Next i
            Myreg = result
            
        Case 2 ' 替换
            ' 使用正则表达式替换匹配项
            regex.pattern = pattern
            Myreg = regex.Replace(StringValue, "")
        
        Case 3 ' 判断
            ' 检查字符串是否符合正则表达式
            regex.pattern = pattern
            If regex.Test(StringValue) Then
                Myreg = True
            Else
                Myreg = False
            End If
            
        Case Else
            ' 无效模式，返回错误值
            Myreg = CVErr(xlErrValue)
            
    End Select
    
    ' 清理对象
    Set regex = Nothing
End Function
```

这两种方法都有其局限性。Python 方法可以批量处理文本，但是太“重”了，每次都要花时间启动、运行，只处理一天数据的场景“性价比”有点低。VBA 方法一个单元格只能处理一天的数据，不方便批量化处理。

那么有没有一种门槛低、对于单独和批量数据都能够灵活处理的方法呢，按照以往经验，我会做个可以交互的界面，因为不懂前端，就会使用 streamlit 来实现。现在有了 AI ，那就方便很多了，我可以让大模型帮我实现，也就不用曲线救国了，省事很多。

说干就干，先来一段提示词。

> 你是一个前端大师，现在我上传了一份《快团团数据》的文件，需求做一个前端页面，我把《快团团数据》中的文本内容贴入，自动帮我提取数据，提取的数据具有固定的格式，如下所示：
>
>  “快团团日报：{日期} 东方购物（订阅领🧧）,订购数量：{东方购物订购数量}单，订购人数：{东方购物订购人数}个，订购金额：{东方购物订购金额}元，利润：{东方购物订购利润}元； 【东方购物】番茄团,订购数量：{番茄团订购数量}单，订购人数：{番茄团订购人数}个，订购金额：{番茄团订购金额}元，利润：{番茄团订购利润}元。” 
>
> 需要转换成表格，表格字段为：{日期}{订购数量}{订购人数}{订购金额}{订购利润} 。
>
> - {订购数量} = {东方购物订购数量} + {番茄团订购数量} 
>
> - {订购人数} = {东方购物订购人数} + {番茄团订购人数} 
>
> -  {订购金额} = {东方购物订购金额} + {番茄团订购金额} 
>
> - {订购利润} = {东方购物订购利润} + {番茄团订购利润} 
>
> - 做一个检查，如果有多个{日期}重复出现，应当取最后一次出现的{日期}及其他字段数据。
>
>   
>
>   将转换后的表格在前端展现，同时提供下载功能，下载表格的文件名使用如下格式：快团团数据_{开始日期}-{结束日期}。
>
>   请帮忙完成此项需求。

十分钟之后，就生成了一个简单的页面，还蛮好看的。

![](https://cdn.jsdelivr.net/gh/don2vito/picgo_warehouse@main/202508221254748.png)

经过测试，数据计算逻辑准确，效果也很不错，操作简单，交互友好，一个小工具就完成了。

数据已经过脱敏处理，大家可以看看效果。

![](https://cdn.jsdelivr.net/gh/don2vito/picgo_warehouse@main/202508221254692.png)

![](https://cdn.jsdelivr.net/gh/don2vito/picgo_warehouse@main/202508221254651.png)