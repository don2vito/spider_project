<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¿«å›¢å›¢æ•°æ®åˆ†æå¹³å°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  
  <!-- Tailwindé…ç½® -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3B82F6',
            secondary: '#10B981',
            accent: '#8B5CF6',
            neutral: '#1F2937',
            'neutral-light': '#F3F4F6',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .shadow-soft {
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }
      .transition-all-300 {
        transition: all 300ms ease-in-out;
      }
      .table-hover-effect tr:hover {
        @apply bg-blue-50/50 transition-all-300;
      }
    }
  </style>
</head>

<body class="bg-gray-50 font-sans text-neutral">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center">
      <div class="flex items-center space-x-2 mb-4 md:mb-0">
        <i class="fa fa-line-chart text-primary text-2xl"></i>
        <h1 class="text-xl md:text-2xl font-bold text-neutral">å¿«å›¢å›¢æ•°æ®åˆ†æå¹³å°</h1>
      </div>
      <div class="flex items-center space-x-4">
        <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-100 transition-all-300">
          <i class="fa fa-moon-o text-neutral"></i>
        </button>
        <button id="help-btn" class="p-2 rounded-full hover:bg-gray-100 transition-all-300">
          <i class="fa fa-question text-neutral"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- ä¸»å†…å®¹åŒº -->
  <main class="container mx-auto px-4 py-8">
    <!-- ä»‹ç»å¡ç‰‡ -->
    <div class="bg-gradient-to-r from-primary/90 to-accent/90 text-white rounded-xl p-6 mb-8 shadow-soft transform hover:scale-[1.01] transition-all-300">
      <h2 class="text-xl font-bold mb-2">æ•°æ®è§£æä¸æ±‡æ€»å·¥å…·</h2>
      <p class="opacity-90">è‡ªåŠ¨è§£æå¿«å›¢å›¢æ—¥æŠ¥æ•°æ®ï¼Œç”Ÿæˆæ±‡æ€»è¡¨æ ¼å¹¶æ”¯æŒä¸‹è½½åŠŸèƒ½ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨åˆå¹¶ç›¸åŒæ—¥æœŸçš„æ•°æ®ï¼Œä¿ç•™æœ€æ–°è®°å½•ã€‚</p>
    </div>
    
    <!-- è¾“å…¥åŒºåŸŸ -->
    <div class="bg-white rounded-xl p-6 mb-8 shadow-soft">
      <h3 class="text-lg font-semibold mb-4 flex items-center">
        <i class="fa fa-file-text-o text-primary mr-2"></i>æ•°æ®è¾“å…¥
      </h3>
      <div class="mb-4">
        <textarea id="data-input" class="w-full h-40 p-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all-300 resize-none" placeholder="è¯·ç²˜è´´å¿«å›¢å›¢æ•°æ®å†…å®¹åˆ°è¿™é‡Œ..."></textarea>
      </div>
      <div class="flex justify-end">
        <button id="parse-btn" class="bg-primary hover:bg-primary/90 text-white px-6 py-2.5 rounded-lg font-medium flex items-center transition-all-300 shadow-md hover:shadow-lg">
          <i class="fa fa-cogs mr-2"></i>è§£ææ•°æ®
        </button>
      </div>
    </div>
    
    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <div id="stats-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 hidden">
      <div class="bg-white rounded-xl p-6 shadow-soft border-l-4 border-primary">
        <p class="text-gray-500 text-sm mb-1">æ€»è®°å½•æ•°</p>
        <h4 id="total-records" class="text-2xl font-bold">0</h4>
      </div>
      <div class="bg-white rounded-xl p-6 shadow-soft border-l-4 border-secondary">
        <p class="text-gray-500 text-sm mb-1">æ€»è®¢è´­æ•°é‡</p>
        <h4 id="total-orders" class="text-2xl font-bold">0</h4>
      </div>
      <div class="bg-white rounded-xl p-6 shadow-soft border-l-4 border-accent">
        <p class="text-gray-500 text-sm mb-1">æ€»è®¢è´­é‡‘é¢</p>
        <h4 id="total-amount" class="text-2xl font-bold">Â¥0</h4>
      </div>
      <div class="bg-white rounded-xl p-6 shadow-soft border-l-4 border-amber-500">
        <p class="text-gray-500 text-sm mb-1">æ€»åˆ©æ¶¦</p>
        <h4 id="total-profit" class="text-2xl font-bold">Â¥0</h4>
      </div>
    </div>
    
    <!-- å›¾è¡¨åŒºåŸŸ -->
    <div id="chart-container" class="bg-white rounded-xl p-6 mb-8 shadow-soft hidden">
      <h3 class="text-lg font-semibold mb-4 flex items-center">
        <i class="fa fa-bar-chart text-primary mr-2"></i>åˆ©æ¶¦è¶‹åŠ¿å›¾
      </h3>
      <div class="h-80">
        <canvas id="profit-chart"></canvas>
      </div>
    </div>
    
    <!-- è¡¨æ ¼åŒºåŸŸ -->
    <div id="table-container" class="bg-white rounded-xl shadow-soft overflow-hidden mb-8 hidden">
      <div class="p-6 border-b border-gray-100 flex justify-between items-center">
        <h3 class="text-lg font-semibold flex items-center">
          <i class="fa fa-table text-primary mr-2"></i>æ±‡æ€»æ•°æ®
        </h3>
        <button id="download-btn" class="bg-secondary hover:bg-secondary/90 text-white px-5 py-2 rounded-lg font-medium flex items-center transition-all-300">
          <i class="fa fa-download mr-2"></i>ä¸‹è½½æ•°æ®
        </button>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full table-hover-effect">
          <thead>
            <tr class="bg-neutral-light">
              <th class="px-6 py-3 text-left text-sm font-semibold text-neutral">æ—¥æœŸ</th>
              <th class="px-6 py-3 text-left text-sm font-semibold text-neutral">è®¢è´­æ•°é‡</th>
              <th class="px-6 py-3 text-left text-sm font-semibold text-neutral">è®¢è´­äººæ•°</th>
              <th class="px-6 py-3 text-left text-sm font-semibold text-neutral">è®¢è´­é‡‘é¢(å…ƒ)</th>
              <th class="px-6 py-3 text-left text-sm font-semibold text-neutral">åˆ©æ¶¦(å…ƒ)</th>
            </tr>
          </thead>
          <tbody id="data-table-body">
            <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
          </tbody>
        </table>
      </div>
      
      <div class="p-4 border-t border-gray-100 flex justify-between items-center">
        <div class="text-sm text-gray-500">æ˜¾ç¤º <span id="shown-records">0</span> æ¡è®°å½•</div>
        <div class="flex space-x-2">
          <button id="prev-page" class="px-3 py-1 rounded border border-gray-200 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <i class="fa fa-chevron-left"></i>
          </button>
          <span id="page-info" class="px-3 py-1">ç¬¬ 1 é¡µ</span>
          <button id="next-page" class="px-3 py-1 rounded border border-gray-200 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <i class="fa fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
    
    <!-- ç©ºçŠ¶æ€æç¤º -->
    <div id="empty-state" class="bg-white rounded-xl p-12 text-center shadow-soft">
      <i class="fa fa-file-text-o text-5xl text-gray-300 mb-4"></i>
      <h3 class="text-xl font-semibold mb-2">å°šæœªè§£ææ•°æ®</h3>
      <p class="text-gray-500 mb-6">è¯·åœ¨ä¸Šæ–¹è¾“å…¥æ¡†ç²˜è´´æ•°æ®å¹¶ç‚¹å‡»"è§£ææ•°æ®"æŒ‰é’®</p>
      <div class="inline-flex items-center text-sm text-gray-500">
        <i class="fa fa-lightbulb-o text-amber-500 mr-2"></i>
        <span>ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†é‡å¤æ—¥æœŸï¼Œä¿ç•™æœ€æ–°è®°å½•</span>
      </div>
    </div>
  </main>

  <!-- é¡µè„š -->
  <footer class="bg-neutral text-white py-8">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          <div class="flex items-center space-x-2">
            <i class="fa fa-line-chart text-primary text-xl"></i>
            <span class="font-semibold">å¿«å›¢å›¢æ•°æ®åˆ†æå¹³å°</span>
          </div>
          <p class="text-gray-400 text-sm mt-2">é«˜æ•ˆè§£ææ•°æ®ï¼ŒåŠ©åŠ›ä¸šåŠ¡å†³ç­–</p>
        </div>
        <div class="flex space-x-6">
          <a href="#" class="text-gray-400 hover:text-white transition-all-300">
            <i class="fa fa-question-circle"></i>
            <span class="ml-1">å¸®åŠ©ä¸­å¿ƒ</span>
          </a>
          <a href="#" class="text-gray-400 hover:text-white transition-all-300">
            <i class="fa fa-envelope"></i>
            <span class="ml-1">è”ç³»æˆ‘ä»¬</span>
          </a>
        </div>
      </div>
      <div class="border-t border-gray-700 mt-6 pt-6 text-center text-gray-400 text-sm">
        &copy; 2024 å¿«å›¢å›¢æ•°æ®åˆ†æå¹³å° - ä¿ç•™æ‰€æœ‰æƒåˆ©
      </div>
    </div>
  </footer>

  <!-- å¸®åŠ©æ¨¡æ€æ¡† -->
  <div id="help-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-xl max-w-lg w-full mx-4 max-h-[80vh] overflow-y-auto">
      <div class="p-6 border-b border-gray-100 flex justify-between items-center sticky top-0 bg-white">
        <h3 class="text-xl font-bold">ä½¿ç”¨å¸®åŠ©</h3>
        <button id="close-help" class="text-gray-500 hover:text-gray-700">
          <i class="fa fa-times"></i>
        </button>
      </div>
      <div class="p-6">
        <div class="mb-6">
          <h4 class="font-semibold text-lg mb-2">å¦‚ä½•ä½¿ç”¨æœ¬å·¥å…·ï¼Ÿ</h4>
          <ol class="list-decimal pl-5 space-y-2 text-gray-700">
            <li>å°†å¿«å›¢å›¢æ•°æ®æ–‡æœ¬ç²˜è´´åˆ°è¾“å…¥æ¡†ä¸­</li>
            <li>ç‚¹å‡»"è§£ææ•°æ®"æŒ‰é’®</li>
            <li>ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†æ•°æ®å¹¶ç”Ÿæˆæ±‡æ€»è¡¨æ ¼</li>
            <li>å¯é€šè¿‡"ä¸‹è½½æ•°æ®"æŒ‰é’®å°†è¡¨æ ¼å¯¼å‡ºä¸ºCSVæ–‡ä»¶</li>
          </ol>
        </div>
        <div>
          <h4 class="font-semibold text-lg mb-2">æ•°æ®å¤„ç†è§„åˆ™</h4>
          <ul class="list-disc pl-5 space-y-2 text-gray-700">
            <li>ç³»ç»Ÿä¼šè‡ªåŠ¨åˆå¹¶ä¸œæ–¹è´­ç‰©å’Œç•ªèŒ„å›¢çš„æ•°æ®</li>
            <li>å¦‚æœå­˜åœ¨ç›¸åŒæ—¥æœŸçš„å¤šæ¡è®°å½•ï¼Œå°†ä¿ç•™æœ€åä¸€æ¬¡å‡ºç°çš„æ•°æ®</li>
            <li>æ±‡æ€»è®¡ç®—æ–¹å¼ï¼š
              <ul class="list-circle pl-5 mt-1">
                <li>æ€»è®¢è´­æ•°é‡ = ä¸œæ–¹è´­ç‰©è®¢è´­æ•°é‡ + ç•ªèŒ„å›¢è®¢è´­æ•°é‡</li>
                <li>æ€»è®¢è´­äººæ•° = ä¸œæ–¹è´­ç‰©è®¢è´­äººæ•° + ç•ªèŒ„å›¢è®¢è´­äººæ•°</li>
                <li>æ€»è®¢è´­é‡‘é¢ = ä¸œæ–¹è´­ç‰©è®¢è´­é‡‘é¢ + ç•ªèŒ„å›¢è®¢è´­é‡‘é¢</li>
                <li>æ€»åˆ©æ¶¦ = ä¸œæ–¹è´­ç‰©åˆ©æ¶¦ + ç•ªèŒ„å›¢åˆ©æ¶¦</li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    // å…¨å±€å˜é‡
    let parsedData = [];
    let currentPage = 1;
    const recordsPerPage = 15;
    let profitChart = null;
    
    // DOMå…ƒç´ 
    const dataInput = document.getElementById('data-input');
    const parseBtn = document.getElementById('parse-btn');
    const dataTableBody = document.getElementById('data-table-body');
    const tableContainer = document.getElementById('table-container');
    const emptyState = document.getElementById('empty-state');
    const statsContainer = document.getElementById('stats-container');
    const chartContainer = document.getElementById('chart-container');
    const downloadBtn = document.getElementById('download-btn');
    const totalRecordsEl = document.getElementById('total-records');
    const totalOrdersEl = document.getElementById('total-orders');
    const totalAmountEl = document.getElementById('total-amount');
    const totalProfitEl = document.getElementById('total-profit');
    const shownRecordsEl = document.getElementById('shown-records');
    const prevPageBtn = document.getElementById('prev-page');
    const nextPageBtn = document.getElementById('next-page');
    const pageInfoEl = document.getElementById('page-info');
    const helpBtn = document.getElementById('help-btn');
    const helpModal = document.getElementById('help-modal');
    const closeHelpBtn = document.getElementById('close-help');
    const themeToggleBtn = document.getElementById('theme-toggle');
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      // å°è¯•ä»localStorageåŠ è½½ç¤ºä¾‹æ•°æ®
      try {
        const sampleData = localStorage.getItem('kuaiduantuan_sample_data');
        if (!sampleData) {
          // è¿™é‡Œå¯ä»¥æ”¾ç½®ç¤ºä¾‹æ•°æ®ï¼Œæ–¹ä¾¿ç”¨æˆ·æµ‹è¯•
        } else {
          dataInput.value = sampleData;
        }
      } catch (e) {
        console.error('æ— æ³•åŠ è½½ç¤ºä¾‹æ•°æ®:', e);
      }
      
      // äº‹ä»¶ç›‘å¬
      parseBtn.addEventListener('click', parseData);
      downloadBtn.addEventListener('click', downloadData);
      prevPageBtn.addEventListener('click', goToPrevPage);
      nextPageBtn.addEventListener('click', goToNextPage);
      helpBtn.addEventListener('click', () => helpModal.classList.remove('hidden'));
      closeHelpBtn.addEventListener('click', () => helpModal.classList.add('hidden'));
      themeToggleBtn.addEventListener('click', toggleTheme);
      
      // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
      helpModal.addEventListener('click', (e) => {
        if (e.target === helpModal) {
          helpModal.classList.add('hidden');
        }
      });
    });
    
    // è§£ææ•°æ®
    function parseData() {
      const input = dataInput.value.trim();
      if (!input) {
        showToast('è¯·è¾“å…¥æ•°æ®å†…å®¹', 'error');
        return;
      }
      
      // ä¿å­˜æ•°æ®åˆ°localStorage
      try {
        localStorage.setItem('kuaiduantuan_sample_data', input);
      } catch (e) {
        console.error('æ— æ³•ä¿å­˜æ•°æ®:', e);
      }
      
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      parseBtn.disabled = true;
      parseBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>è§£æä¸­...';
      
      // ä½¿ç”¨setTimeoutæ¨¡æ‹Ÿå¼‚æ­¥å¤„ç†ï¼Œé¿å…UIå†»ç»“
      setTimeout(() => {
        try {
          // æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å¿«å›¢å›¢æ—¥æŠ¥æ•°æ®
          const regex = /å¿«å›¢å›¢æ—¥æŠ¥ï¼š(\d{4}\d{2}\d{2})[\s\S]*?ä¸œæ–¹è´­ç‰©ï¼ˆè®¢é˜…é¢†ğŸ§§ï¼‰,è®¢è´­æ•°é‡ï¼š(\d+)å•ï¼Œè®¢è´­äººæ•°ï¼š(\d+)ä¸ªï¼Œè®¢è´­é‡‘é¢ï¼š([\d.]+)å…ƒï¼Œåˆ©æ¶¦ï¼š([\d.-]+)å…ƒï¼›[\s\S]*?ã€ä¸œæ–¹è´­ç‰©ã€‘ç•ªèŒ„å›¢,è®¢è´­æ•°é‡ï¼š(\d+)å•ï¼Œè®¢è´­äººæ•°ï¼š(\d+)ä¸ªï¼Œè®¢è´­é‡‘é¢ï¼š([\d.]+)å…ƒï¼Œåˆ©æ¶¦ï¼š([\d.-]+)å…ƒ./g;
          
          const dataMap = new Map();
          let match;
          
          // æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…é¡¹
          while ((match = regex.exec(input)) !== null) {
            const date = match[1];
            // ä¸œæ–¹è´­ç‰©æ•°æ®
            const dgOrders = parseInt(match[2]);
            const dgPeople = parseInt(match[3]);
            const dgAmount = parseFloat(match[4]);
            const dgProfit = parseFloat(match[5]);
            
            // ç•ªèŒ„å›¢æ•°æ®
            const fmOrders = parseInt(match[6]);
            const fmPeople = parseInt(match[7]);
            const fmAmount = parseFloat(match[8]);
            const fmProfit = parseFloat(match[9]);
            
            // è®¡ç®—æ±‡æ€»æ•°æ®
            const totalOrders = dgOrders + fmOrders;
            const totalPeople = dgPeople + fmPeople;
            const totalAmount = dgAmount + fmAmount;
            const totalProfit = dgProfit + fmProfit;
            
            // æ ¼å¼åŒ–æ—¥æœŸ (YYYYMMDD -> YYYY-MM-DD)
            const formattedDate = `${date.slice(0, 4)}-${date.slice(4, 6)}-${date.slice(6, 8)}`;
            
            // å­˜å‚¨æ•°æ®ï¼Œè¦†ç›–é‡å¤æ—¥æœŸï¼ˆä¿ç•™æœ€åä¸€æ¡ï¼‰
            dataMap.set(date, {
              date: formattedDate,
              originalDate: date,
              dgOrders,
              dgPeople,
              dgAmount,
              dgProfit,
              fmOrders,
              fmPeople,
              fmAmount,
              fmProfit,
              totalOrders,
              totalPeople,
              totalAmount,
              totalProfit
            });
          }
          
          // è½¬æ¢ä¸ºæ•°ç»„å¹¶æŒ‰æ—¥æœŸæ’åº
          parsedData = Array.from(dataMap.values()).sort((a, b) => {
            return a.originalDate.localeCompare(b.originalDate);
          });
          
          // æ›´æ–°UI
          updateTable();
          updateStats();
          renderChart();
          
          // æ˜¾ç¤ºç»“æœåŒºåŸŸï¼Œéšè—ç©ºçŠ¶æ€
          tableContainer.classList.remove('hidden');
          statsContainer.classList.remove('hidden');
          chartContainer.classList.remove('hidden');
          emptyState.classList.add('hidden');
          
          showToast(`æˆåŠŸè§£æ ${parsedData.length} æ¡è®°å½•`, 'success');
        } catch (error) {
          console.error('è§£ææ•°æ®å‡ºé”™:', error);
          showToast('è§£ææ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼', 'error');
        } finally {
          // æ¢å¤æŒ‰é’®çŠ¶æ€
          parseBtn.disabled = false;
          parseBtn.innerHTML = '<i class="fa fa-cogs mr-2"></i>è§£ææ•°æ®';
        }
      }, 300);
    }
    
    // æ›´æ–°è¡¨æ ¼
    function updateTable() {
      // æ¸…ç©ºè¡¨æ ¼
      dataTableBody.innerHTML = '';
      
      // è®¡ç®—åˆ†é¡µ
      const totalPages = Math.ceil(parsedData.length / recordsPerPage);
      const startIndex = (currentPage - 1) * recordsPerPage;
      const endIndex = Math.min(startIndex + recordsPerPage, parsedData.length);
      const currentRecords = parsedData.slice(startIndex, endIndex);
      
      // æ›´æ–°åˆ†é¡µä¿¡æ¯
      pageInfoEl.textContent = `ç¬¬ ${currentPage} / ${totalPages} é¡µ`;
      prevPageBtn.disabled = currentPage === 1;
      nextPageBtn.disabled = currentPage === totalPages;
      shownRecordsEl.textContent = parsedData.length;
      
      // æ·»åŠ è®°å½•
      currentRecords.forEach((item, index) => {
        const row = document.createElement('tr');
        row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
        
        // æ ¼å¼åŒ–é‡‘é¢å’Œåˆ©æ¶¦ï¼Œä¿ç•™ä¸¤ä½å°æ•°
        const amountFormatted = item.totalAmount.toFixed(2);
        const profitFormatted = item.totalProfit.toFixed(2);
        
        row.innerHTML = `
          <td class="px-6 py-4">${item.date}</td>
          <td class="px-6 py-4">${item.totalOrders}</td>
          <td class="px-6 py-4">${item.totalPeople}</td>
          <td class="px-6 py-4">Â¥${amountFormatted}</td>
          <td class="px-6 py-4 font-medium ${item.totalProfit >= 0 ? 'text-secondary' : 'text-red-500'}">
            Â¥${profitFormatted}
          </td>
        `;
        
        dataTableBody.appendChild(row);
      });
      
      // å¦‚æœå½“å‰é¡µæ²¡æœ‰æ•°æ®ï¼Œå°è¯•å‰ä¸€é¡µ
      if (currentRecords.length === 0 && currentPage > 1) {
        currentPage--;
        updateTable();
      }
    }
    
    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    function updateStats() {
      // è®¡ç®—æ€»è®¡
      const totalRecords = parsedData.length;
      const totalOrders = parsedData.reduce((sum, item) => sum + item.totalOrders, 0);
      const totalAmount = parsedData.reduce((sum, item) => sum + item.totalAmount, 0);
      const totalProfit = parsedData.reduce((sum, item) => sum + item.totalProfit, 0);
      
      // æ›´æ–°UI
      totalRecordsEl.textContent = totalRecords;
      totalOrdersEl.textContent = totalOrders.toLocaleString();
      totalAmountEl.textContent = `Â¥${totalAmount.toFixed(2)}`;
      totalProfitEl.textContent = `Â¥${totalProfit.toFixed(2)}`;
    }
    
    // æ¸²æŸ“åˆ©æ¶¦è¶‹åŠ¿å›¾
    function renderChart() {
      // é”€æ¯ç°æœ‰å›¾è¡¨
      if (profitChart) {
        profitChart.destroy();
      }
      
      // å‡†å¤‡å›¾è¡¨æ•°æ®
      // ä¸ºäº†å›¾è¡¨å¯è¯»æ€§ï¼Œåªå–æœ€è¿‘30å¤©çš„æ•°æ®
      const chartData = parsedData.slice(-30);
      const labels = chartData.map(item => item.date);
      const profits = chartData.map(item => item.totalProfit);
      
      // åˆ›å»ºå›¾è¡¨
      const ctx = document.getElementById('profit-chart').getContext('2d');
      profitChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'æ¯æ—¥åˆ©æ¶¦',
            data: profits,
            borderColor: '#3B82F6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            borderWidth: 2,
            tension: 0.3,
            fill: true,
            pointBackgroundColor: '#3B82F6',
            pointRadius: 3,
            pointHoverRadius: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `åˆ©æ¶¦: Â¥${context.raw.toFixed(2)}`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return 'Â¥' + value;
                }
              }
            }
          }
        }
      });
    }
    
    // ä¸‹è½½æ•°æ®
    function downloadData() {
      if (parsedData.length === 0) {
        showToast('æ²¡æœ‰å¯ä¸‹è½½çš„æ•°æ®', 'warning');
        return;
      }
      
      // æ„å»ºCSVå†…å®¹
      let csvContent = "æ—¥æœŸ,è®¢è´­æ•°é‡,è®¢è´­äººæ•°,è®¢è´­é‡‘é¢(å…ƒ),åˆ©æ¶¦(å…ƒ)\n";
      
      parsedData.forEach(item => {
        csvContent += `${item.date},${item.totalOrders},${item.totalPeople},${item.totalAmount.toFixed(2)},${item.totalProfit.toFixed(2)}\n`;
      });
      
      // åˆ›å»ºä¸‹è½½é“¾æ¥
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', `å¿«å›¢å›¢æ•°æ®æ±‡æ€»_${new Date().toLocaleDateString()}.csv`);
      link.style.visibility = 'hidden';
      
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showToast('æ•°æ®å·²æˆåŠŸä¸‹è½½', 'success');
    }
    
    // åˆ†é¡µæ§åˆ¶
    function goToPrevPage() {
      if (currentPage > 1) {
        currentPage--;
        updateTable();
      }
    }
    
    function goToNextPage() {
      const totalPages = Math.ceil(parsedData.length / recordsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        updateTable();
      }
    }
    
    // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
    function showToast(message, type = 'info') {
      // åˆ›å»ºtoastå…ƒç´ 
      const toast = document.createElement('div');
      toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 flex items-center transition-all duration-300 transform translate-y-10 opacity-0`;
      
      // æ ¹æ®ç±»å‹è®¾ç½®æ ·å¼
      switch (type) {
        case 'success':
          toast.classList.add('bg-green-50', 'text-green-800', 'border-l-4', 'border-green-500');
          toast.innerHTML = `<i class="fa fa-check-circle mr-2 text-green-500"></i>${message}`;
          break;
        case 'error':
          toast.classList.add('bg-red-50', 'text-red-800', 'border-l-4', 'border-red-500');
          toast.innerHTML = `<i class="fa fa-exclamation-circle mr-2 text-red-500"></i>${message}`;
          break;
        case 'warning':
          toast.classList.add('bg-yellow-50', 'text-yellow-800', 'border-l-4', 'border-yellow-500');
          toast.innerHTML = `<i class="fa fa-exclamation-triangle mr-2 text-yellow-500"></i>${message}`;
          break;
        default:
          toast.classList.add('bg-blue-50', 'text-blue-800', 'border-l-4', 'border-blue-500');
          toast.innerHTML = `<i class="fa fa-info-circle mr-2 text-blue-500"></i>${message}`;
      }
      
      // æ·»åŠ åˆ°é¡µé¢
      document.body.appendChild(toast);
      
      // æ˜¾ç¤ºåŠ¨ç”»
      setTimeout(() => {
        toast.classList.remove('translate-y-10', 'opacity-0');
      }, 10);
      
      // è‡ªåŠ¨æ¶ˆå¤±
      setTimeout(() => {
        toast.classList.add('translate-y-10', 'opacity-0');
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 3000);
    }
    
    // åˆ‡æ¢ä¸»é¢˜
    function toggleTheme() {
      const isDarkMode = document.documentElement.classList.toggle('dark');
      const icon = themeToggleBtn.querySelector('i');
      
      if (isDarkMode) {
        icon.classList.remove('fa-moon-o');
        icon.classList.add('fa-sun-o');
        document.body.classList.add('bg-gray-900', 'text-white');
        document.body.classList.remove('bg-gray-50', 'text-neutral');
      } else {
        icon.classList.remove('fa-sun-o');
        icon.classList.add('fa-moon-o');
        document.body.classList.remove('bg-gray-900', 'text-white');
        document.body.classList.add('bg-gray-50', 'text-neutral');
      }
    }
  </script>
</body>
</html>
